# 思源笔记脚本项目配置系统使用说明

## 概述

本项目已将所有脚本的默认导出目录统一到一个配置文件中，支持统一修改和管理。通过配置文件，您可以轻松地：

- 修改基础导出目录
- 调整各种导出子目录
- 配置思源笔记相关参数
- 设置为知笔记导出参数
- 管理媒体文件配置

## 配置文件结构

### 主要配置文件

- `config.py` - 核心配置类和便捷函数
- `config_manager.py` - 配置管理工具
- `project_config.json` - 示例配置文件

### 配置项说明

```json
{
  "base_export_dir": "H:/为知笔记导出MD备份",  // 基础导出目录
  "export_subdirs": {
    "wiznotes": "My Emails",           // 为知笔记导出目录
    "urls": "urls_to_markdown",        // URL转Markdown导出目录
    "clips": "clips_to_markdown",      // 剪贴板内容转Markdown导出目录
    "processed": "已转思源"             // 已处理文件移动目录
  },
  "siyuan": {
    "default_notebook": "剪藏笔记本",           // 默认笔记本名称
    "default_parent_folder": "/Web收集箱/urls2markdown"  // 默认父文件夹
  },
  "wiznotes": {
    "default_folders": ["/My Emails/"],  // 默认导出的为知笔记文件夹
    "max_workers": 3                     // 并行下载线程数
  },
  "media": {
    "download_media": true,              // 是否下载媒体文件
    "media_subdir": "media"              // 媒体文件子目录名
  }
}
```

## 使用方法

### 1. 命令行配置管理

#### 显示当前配置
```bash
python config_manager.py --show
```

#### 修改基础导出目录
```bash
python config_manager.py --base "D:/我的文档/笔记备份"
```

#### 修改子目录
```bash
python config_manager.py --subdir wiznotes "我的邮件"
```

#### 保存配置到文件
```bash
python config_manager.py --save my_config.json
```

#### 从文件加载配置
```bash
python config_manager.py --load my_config.json
```

#### 测试路径配置
```bash
python config_manager.py --test
```

### 2. 交互式配置编辑器

启动交互式配置编辑器：
```bash
python config_manager.py --interactive
```

在交互式编辑器中，您可以：
- 输入 `help` 查看可用命令
- 输入 `show` 显示当前配置
- 输入 `base` 修改基础导出目录
- 输入 `subdir` 修改导出子目录
- 输入 `save` 保存配置
- 输入 `load` 加载配置
- 输入 `test` 测试路径
- 输入 `quit` 退出编辑器

### 3. 在代码中使用配置

#### 导入配置模块
```python
from config import get_config, get_wiznotes_path, get_urls_path

# 获取配置实例
config = get_config()

# 获取特定路径
wiznotes_path = get_wiznotes_path()
urls_path = get_urls_path()
```

#### 使用配置值
```python
# 获取基础导出目录
base_dir = config.base_export_dir

# 获取为知笔记配置
max_workers = config.wiznotes["max_workers"]
default_folders = config.wiznotes["default_folders"]

# 获取思源笔记配置
notebook_name = config.siyuan["default_notebook"]
parent_folder = config.siyuan["default_parent_folder"]
```

## 已更新的脚本

以下脚本已更新为使用新的配置系统：

- ✅ `wiznotes_to_siyuan.py` - 为知笔记转思源笔记主流程
- ✅ `export_wiznotes_to_md.py` - 为知笔记导出为Markdown
- ✅ `create_notes_from_md.py` - 从Markdown创建思源笔记
- ✅ `urls_to_siyuan.py` - URL转思源笔记流程
- ✅ `urls_to_markdown.py` - URL转Markdown

## 配置优先级

配置的优先级从高到低为：

1. 环境变量（如 `MD_FOLDER`）
2. 配置文件中的设置
3. 代码中的默认值

## 注意事项

1. **路径格式**：配置文件中的路径使用正斜杠 `/`，在Windows系统上会自动转换为正确的格式
2. **目录创建**：脚本会自动创建必要的目录结构
3. **配置持久化**：使用 `--save` 命令保存的配置会持久化到JSON文件中
4. **向后兼容**：原有的环境变量配置仍然有效

## 示例：修改导出目录

如果您想将导出目录从 `H:/为知笔记导出MD备份` 改为 `D:/笔记备份`：

### 方法1：命令行
```bash
python config_manager.py --base "D:/笔记备份"
```

### 方法2：交互式编辑器
```bash
python config_manager.py --interactive
# 然后输入 base 命令
```

### 方法3：直接编辑JSON文件
编辑 `project_config.json` 文件，将 `base_export_dir` 改为 `"D:/笔记备份"`

## 故障排除

### 配置不生效
1. 检查配置文件是否正确加载
2. 确认脚本中已导入配置模块
3. 验证路径格式是否正确

### 路径不存在
1. 使用 `--test` 命令测试路径配置
2. 检查目录权限
3. 确认路径格式符合操作系统要求

### 配置加载失败
1. 检查JSON文件格式是否正确
2. 确认文件编码为UTF-8
3. 验证文件路径是否正确

## 技术支持

如果您在使用配置系统时遇到问题，请：

1. 查看错误日志
2. 使用 `--test` 命令检查路径配置
3. 确认配置文件格式正确
4. 检查Python环境是否正常
